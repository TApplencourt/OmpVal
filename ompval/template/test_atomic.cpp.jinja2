#include <stdlib.h>
#include <numeric>
#include <math.h>
#include <cassert>
#include <iostream>
#include <cmath>

void test_{{name}}(){

    // Declare Size of array
    {% for name, value in zip(l_var_array_size, l_array_size) %}
    const int {{ name }} = {{value}};
    {%- endfor %}

    // Initialize array
    int A = 0;

    // Computation
    {%- if l_var_array_size | length -%}
        {% for structured_block, (loop_pragma, i, N) in l_pragma2 %}
            {% for pragma in structured_block %}
                #pragma omp {{pragma}} {% if is_target(pragma) %} map(from: A) {% endif %}
            {
            {% endfor %}

            {% if loop_pragma %}
                #pragma omp {{loop_pragma}} {% if is_target(loop_pragma) %} map(from: A) {% endif %}
                for (int {{i}} = 0 ; {{i}} < {{N}} ; {{i}}++ )
            {% endif %}
            {
        {% endfor %}
        {%if not l_pragma2[-1][1][0].endswith("simd") %}
        #pragma omp atomic update
        {% endif %}
        A++;
        {%- for _ in l_pragma %}
        }
        {%- endfor -%}
    {% endif %}

    // Validation
    {%- if l_var_array_size | length -%}
        assert( A < 100000);
    {%- endif %}
    std::cout << "OK" << std::endl ;
}   

int main()
{
    test_{{name}}();
}

